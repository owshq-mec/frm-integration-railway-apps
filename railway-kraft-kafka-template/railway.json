{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE"
  },
  "deploy": {
    "numReplicas": 1,
    "sleepApplication": false,
    "restartPolicyType": "ON_FAILURE"
  },
  "environments": {
    "production": {
      "variables": {
        "KAFKA_CLUSTER_ID": "${{ secret(KAFKA_CLUSTER_ID) || 'kraft-railway-cluster-' + RAILWAY_SERVICE_ID }}",
        "KAFKA_NODE_ID": "1",
        "KAFKA_PROCESS_ROLES": "broker,controller",
        "KAFKA_CONTROLLER_QUORUM_VOTERS": "1@localhost:9093",
        
        "KAFKA_INTER_BROKER_LISTENER_NAME": "PLAINTEXT",
        "KAFKA_CONTROLLER_LISTENER_NAMES": "CONTROLLER",
        
        "KAFKA_LOG_DIRS": "/var/lib/kafka/data",
        "KAFKA_LOG_RETENTION_HOURS": "168",
        "KAFKA_LOG_RETENTION_BYTES": "1073741824",
        "KAFKA_LOG_SEGMENT_BYTES": "1073741824",
        "KAFKA_LOG_CLEANUP_POLICY": "delete",
        
        "KAFKA_NUM_PARTITIONS": "3",
        "KAFKA_DEFAULT_REPLICATION_FACTOR": "1",
        "KAFKA_MIN_INSYNC_REPLICAS": "1",
        "KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR": "1",
        "KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR": "1",
        "KAFKA_TRANSACTION_STATE_LOG_MIN_ISR": "1",
        
        "KAFKA_GROUP_INITIAL_REBALANCE_DELAY_MS": "0",
        "KAFKA_AUTO_CREATE_TOPICS_ENABLE": "true",
        "KAFKA_DELETE_TOPIC_ENABLE": "true",
        
        "KAFKA_HEAP_OPTS": "-Xmx512m -Xms512m",
        "KAFKA_JVM_PERFORMANCE_OPTS": "-server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35",
        "KAFKA_JMX_PORT": "9999",
        "KAFKA_JMX_HOSTNAME": "localhost",
        
        "KAFKA_COMPRESSION_TYPE": "snappy",
        "KAFKA_MAX_REQUEST_SIZE": "5242880",
        "KAFKA_REPLICA_FETCH_MAX_BYTES": "5242880",
        "KAFKA_MESSAGE_MAX_BYTES": "5242880",
        
        "RAILWAY_TCP_APPLICATION_PORT": "9092",
        "RAILWAY_TCP_PROXY_DOMAIN": "${{ RAILWAY_TCP_PROXY_DOMAIN }}",
        "RAILWAY_TCP_PROXY_PORT": "${{ RAILWAY_TCP_PROXY_PORT }}"
      }
    },
    "staging": {
      "variables": {
        "KAFKA_CLUSTER_ID": "kraft-staging-cluster",
        "KAFKA_HEAP_OPTS": "-Xmx256m -Xms256m",
        "KAFKA_LOG_RETENTION_HOURS": "24",
        "KAFKA_LOG_RETENTION_BYTES": "268435456",
        "KAFKA_NUM_PARTITIONS": "1"
      }
    }
  }
}